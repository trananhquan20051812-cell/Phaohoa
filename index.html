<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>bắn tùm lum</title>
    <style>
        body { margin: 0; background: #000; overflow: hidden; font-family: 'Segoe UI', sans-serif; }
        #ui {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            text-align: center; color: #fff; z-index: 100; transition: 0.8s;
        }
        h1 { font-size: 4rem; margin: 0; color: gold; text-shadow: 2px 2px 4px #ff0000; }
        button {
            padding: 15px 40px; font-size: 1.5rem; background: none; border: 2px solid gold;
            color: gold; border-radius: 30px; cursor: pointer; margin-top: 20px;
        }
        button:hover { background: gold; color: #000; box-shadow: 0 0 15px gold; }
        canvas { display: block; }
    </style>
</head>
<body>

    <div id="ui">
        <h1>HAPPY NEW YEAR 2026</h1>
        <button onclick="start()">KHAI HỎA</button>
    </div>

    <audio id="music" loop>
        <source src="music.mp3" type="audio/mpeg">
    </audio>

    <canvas id="canvas"></canvas>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const music = document.getElementById('music');
        const ui = document.getElementById('ui');

        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        window.addEventListener('resize', () => {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        });

        const random = (min, max) => Math.random() * (max - min) + min;

        class Particle {
            constructor(x, y, color, velocity, isHeart) {
                this.x = x;
                this.y = y;
                this.color = color;
                this.velocity = velocity;
                this.alpha = 1;
                this.friction = 0.96; // Lực cản
                this.gravity = 0.12;  // Trọng lực
                this.size = isHeart ? 2.2 : 1.8; // Kích thước hạt nhỏ lại chút cho sắc nét
            }

            draw() {
                ctx.save();
                ctx.globalAlpha = this.alpha;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fillStyle = this.color;
                // ĐÃ XOÁ: shadowBlur và shadowColor để loại bỏ glow
                ctx.fill();
                ctx.restore();
            }

            update() {
                this.velocity.x *= this.friction;
                this.velocity.y *= this.friction;
                this.velocity.y += this.gravity;
                this.x += this.velocity.x;
                this.y += this.velocity.y;
                this.alpha -= 0.012; // Phai chậm hơn một chút
            }
        }

        class Firework {
            constructor() {
                this.x = random(100, canvas.width - 100);
                this.y = canvas.height;
                // Màu chính của quả pháo này
                this.mainColor = `hsl(${random(0, 360)}, 100%, 60%)`;
                this.targetY = random(50, canvas.height / 2.5);
                this.velocity = { x: random(-1, 1), y: random(-11, -17) };
                this.particles = [];
                this.exploded = false;
            }

            draw() {
                if (!this.exploded) {
                    ctx.beginPath();
                    // Kích thước đầu pháo khi bay lên
                    ctx.arc(this.x, this.y, 2.5, 0, Math.PI * 2);
                    // YÊU CẦU 2: Pháo đi lên màu gì thì vẽ màu đó
                    ctx.fillStyle = this.mainColor;
                    // ĐÃ XOÁ: shadowBlur cho đầu pháo
                    ctx.fill();
                }
                this.particles.forEach(p => p.draw());
            }

            update() {
                if (!this.exploded) {
                    this.x += this.velocity.x;
                    this.y += this.velocity.y;
                    this.velocity.y += 0.15;

                    if (this.velocity.y >= -1 || this.y <= this.targetY) {
                        this.exploded = true;
                        this.explode();
                    }
                }

                for (let i = this.particles.length - 1; i >= 0; i--) {
                    this.particles[i].update();
                    if (this.particles[i].alpha <= 0) {
                        this.particles.splice(i, 1);
                    }
                }
            }

            explode() {
                const count = 180; // Tăng số lượng hạt
                const isHeart = Math.random() < 0.25;
                // YÊU CẦU 3: 15% cơ hội nổ ra pháo đa sắc
                const isMulticolored = Math.random() < 0.15;

                for (let i = 0; i < count; i++) {
                    let vx, vy;
                    // Tính toán hình dáng
                    if (isHeart) {
                        const angle = (i / count) * Math.PI * 2;
                        vx = 16 * Math.pow(Math.sin(angle), 3);
                        vy = -(13 * Math.cos(angle) - 5 * Math.cos(2 * angle) - 2 * Math.cos(3 * angle) - Math.cos(4 * angle));
                        const scale = 0.35;
                        vx *= scale * random(0.9, 1.1);
                        vy *= scale * random(0.9, 1.1);
                    } else {
                        const angle = Math.random() * Math.PI * 2;
                        const speed = random(1, 8);
                        vx = Math.cos(angle) * speed;
                        vy = Math.sin(angle) * speed;
                    }

                    // Xác định màu cho từng hạt
                    let particleColor;
                    if (isMulticolored) {
                        // Nếu là pháo đa sắc, mỗi hạt 1 màu ngẫu nhiên
                        particleColor = `hsl(${random(0, 360)}, 100%, 60%)`;
                    } else {
                        // Nếu không, dùng màu chính của quả pháo
                        particleColor = this.mainColor;
                    }

                    this.particles.push(new Particle(this.x, this.y, particleColor, { x: vx, y: vy }, isHeart));
                }
            }
        }

        let fireworks = [];

        function animate() {
            // Tăng độ mờ của nền đen để đuôi pháo ngắn lại, nhìn gọn hơn
            ctx.fillStyle = 'rgba(0, 0, 0, 0.25)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Tăng nhẹ tần suất bắn pháo
            if (Math.random() < 0.06) {
                fireworks.push(new Firework());
            }

            for (let i = fireworks.length - 1; i >= 0; i--) {
                fireworks[i].update();
                fireworks[i].draw();
                if (fireworks[i].exploded && fireworks[i].particles.length === 0) {
                    fireworks.splice(i, 1);
                }
            }
            requestAnimationFrame(animate);
        }

        function start() {
            ui.style.opacity = '0';
            setTimeout(() => ui.style.display = 'none', 800);
            music.play().catch(e => console.log("Cần tương tác để phát nhạc"));
            animate();
        }
    </script>
</body>
</html>
